!function(){"use strict";var a=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=(tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),tinymce.util.Tools.resolve("tinymce.util.Tools"),"span.explanation"),c=function(a){return!a},d=function(a){var b;return(b=a)&&"span"===b.nodeName.toLowerCase()&&"explanation"==a.getAttribute("class")},e=function(a){return a.dom.getParent(a.selection.getStart(),b)},f=function(b){var c,a=e(b);return a&&(c=a).getAttribute("data-tooltip")||""},g=function(a,b,c){c.setAttribute("data-tooltip",b),a.addVisual(),a.undoManager.add()},h=function(a,b){a.undoManager.transact(function(){var c=a.selection.getContent({format:"html"}).trim();a.insertContent(a.dom.createHTML("span",{"data-tooltip":b.trim(),class:"explanation"},a.dom.encode(c.trim())))}),a.focus()},i=function(a,b){var c=e(a);c?g(a,b,c):h(a,b),a.focus()},j=function(a){var b=f(a);a.windowManager.open({icon:"comment-add",title:"Explanation",size:"normal",body:{type:"panel",items:[{type:"textarea",name:"explanation",label:"Explanation text",placeholder:"Example",flex:!0}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{explanation:b},onSubmit:function(b){i(a,b.getData().explanation),b.close()}})},k=function(a){a.addCommand("mceExplanation",function(){j(a)})},l=function(a){var b;return(b=a)&&c(!c(b.attr("data-tooltip")))&&!a.firstChild},m=function(a){return function(c){for(var b=0;b<c.length;b++){var d=c[b];l(d)&&d.attr("contenteditable",a)}}},n=function(a){a.on("PreInit",function(){a.parser.addNodeFilter("span",m("false")),a.serializer.addNodeFilter("span",m(null))})},o=function(a){a.formatter.register("namedExplanation",{inline:"span",selector:b,remove:"all",split:!0,deep:!0,attributes:{"data-tooltip":"%value"},onmatch:function(a,b,c){return d(a)}})},p=function(a){a.ui.registry.addToggleButton("explanation",{icon:"comment-add",tooltip:"Explanation",onAction:function(){return a.execCommand("mceExplanation")},onSetup:function(b){return a.selection.selectorChangedWithUnbind("span.explanation",b.setActive).unbind}}),a.ui.registry.addMenuItem("explanation",{icon:"comment-add",text:"Explanation...",onAction:function(){return a.execCommand("mceExplanation")}})};a.add("explanation",function(a){n(a),k(a),p(a),a.on("PreInit",function(){o(a)})})}()