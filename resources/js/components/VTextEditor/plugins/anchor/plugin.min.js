!function(){"use strict";var a=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),c=tinymce.util.Tools.resolve("tinymce.util.Tools"),d="a:not([href])",e=function(a){return!a},f=function(a){return a.getAttribute("id")||a.getAttribute("name")||""},g=function(a){var b;return(b=a)&&"a"===b.nodeName.toLowerCase()&&!a.getAttribute("href")&&""!==f(a)},h=function(a){var d=a.dom;b(d).walk(a.selection.getRng(),function(a){c.each(a,function(a){var b;g(b=a)&&!b.firstChild&&d.remove(a,!1)})})},i=function(a){return a.dom.getParent(a.selection.getStart(),d)},j=function(b){var a=i(b);return a?f(a):""},k=function(a,b){a.undoManager.transact(function(){var c;a.getParam("allow_html_in_named_anchor",!1,"boolean")||a.selection.collapse(!0),a.selection.isCollapsed()?a.insertContent(a.dom.createHTML("a",{id:b})):(h(a),a.formatter.remove("namedAnchor",null,null,!0),a.formatter.apply("namedAnchor",{value:b}),a.addVisual())})},l=function(a,c,b){b.removeAttribute("name"),b.id=c,a.addVisual(),a.undoManager.add()},m=function(a,b){var c=i(a);c?l(a,b,c):k(a,b),a.focus()},n=function(b,c){var a;return(a=c,(!(/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(a)&&a.includes("-"))||"-"==a.charAt(0)||"-"==a.charAt(a.length-1))&&(a.includes(" ")||/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(a)))?(b.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1):(m(b,c),!0)},o=function(a){var b=j(a);a.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:b},onSubmit:function(b){n(a,b.getData().id)&&b.close()}})},p=function(a){a.addCommand("mceAnchor",function(){o(a)})},q=function(b){var a;return(a=b)&&e(a.attr("href"))&&!e(a.attr("id")||a.attr("name"))&&!b.firstChild},r=function(a){return function(c){for(var b=0;b<c.length;b++){var d=c[b];q(d)&&d.attr("contenteditable",a)}}},s=function(a){a.on("PreInit",function(){a.parser.addNodeFilter("a",r("false")),a.serializer.addNodeFilter("a",r(null))})},t=function(a){a.formatter.register("namedAnchor",{inline:"a",selector:d,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:function(a,b,c){return g(a)}})},u=function(a){a.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:function(){return a.execCommand("mceAnchor")},onSetup:function(b){return a.selection.selectorChangedWithUnbind("a:not([href]):not(.toc)",b.setActive).unbind}}),a.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:function(){return a.execCommand("mceAnchor")}})};a.add("anchor",function(a){s(a),p(a),u(a),a.on("PreInit",function(){t(a)})})}()