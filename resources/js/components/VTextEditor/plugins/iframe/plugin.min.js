!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),n=tinymce.util.Tools.resolve("tinymce.util.Tools"),r='span[data-mce-object="iframe"]',a=function(e){return e.getAttribute("src")||""},i=function(e){var t;return(t=e)&&"iframe"===t.nodeName.toLowerCase()&&!e.getAttribute("src")&&""!==a(e)},o=function(e){var r=e.dom;t(r).walk(e.selection.getRng(),function(e){n.each(e,function(e){var t;i(t=e)&&!t.firstChild&&r.remove(e,!1)})})},c=function(e){var t=e.dom.getParent(e.selection.getStart(),r);return t?t.querySelector("iframe.iframe-obj"):""},u=function(e){var t=c(e);return t?a(t):""},l=function(e,t){e.undoManager.transact(function(){e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("iframe",{src:t,style:"width: 100%; height: 100vh",class:"iframe-obj"})):(o(e),e.formatter.remove("namedIframe",null,null,!0),e.formatter.apply("namedIframe",{value:t}),e.addVisual())})},m=function(e,t,n){e.insertContent(e.dom.createHTML("iframe",{src:t,style:"width: 100%; height: 100vh",class:"iframe-obj"})),e.addVisual(),e.undoManager.add()},f=function(e,t){var n=c(e);n?m(e,t,n):l(e,t),e.focus()},s=function(e){var t=u(e);e.windowManager.open({title:"Insert/Edit Iframe",size:"normal",body:{type:"panel",items:[{name:"src",type:"input",label:"Source",placeholder:""}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{src:t},onSubmit:function(t){var n,r;n=e,f(n,r=t.getData().src),t.close()}})},d=function(e){e.addCommand("mceIframe",function(){s(e)})},v=function(e){var t;return e&&!(t=e.attr("src"))},g=function(e){return function(t){for(var n=0;n<t.length;n++){var r,a=t[n];v(r=a)&&!r.firstChild&&a.attr("contenteditable",e)}}},p=function(e){e.on("PreInit",function(){e.parser.addNodeFilter("iframe",g("false")),e.serializer.addNodeFilter("iframe",g(null))})},b=function(e){e.formatter.register("namedIframe",{inline:"iframe",selector:r,remove:"all",split:!0,deep:!0,attributes:{src:"%value"},onmatch:function(e,t,n){return i(e)}})},y=function(e){e.ui.registry.addToggleButton("iframe",{icon:"embed-page",tooltip:"Embed iframe",onAction:function(){return e.execCommand("mceIframe")},onSetup:function(t){e.on("NodeChange",function n(){let r=e.selection.getNode();var a=r.querySelector("iframe.iframe-obj");return t.setActive(null!==a)})}}),e.ui.registry.addMenuItem("iframe",{icon:"embed-page",text:"Iframe...",onAction:function(){return e.execCommand("mceIframe")}})};e.add("iframe",function(e){p(e),d(e),y(e),e.on("PreInit",function(){b(e)})})}();